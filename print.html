<!DOCTYPE HTML>
<html lang="en" class="light" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>GitNotebooks Docs</title>
        <meta name="robots" content="noindex">


        <!-- Custom HTML head -->
        
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="favicon.svg">
        <link rel="shortcut icon" href="favicon.png">
        <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
        <link rel="stylesheet" href="css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="highlight.css">
        <link rel="stylesheet" href="tomorrow-night.css">
        <link rel="stylesheet" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->

    </head>
    <body class="sidebar-visible no-js">
    <div id="body-container">
        <!-- Provide site root to javascript -->
        <script>
            var path_to_root = "";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('light')
            html.classList.add(theme);
            var body = document.querySelector('body');
            body.classList.remove('no-js')
            body.classList.add('js');
        </script>

        <input type="checkbox" id="sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            var body = document.querySelector('body');
            var sidebar = null;
            var sidebar_toggle = document.getElementById("sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
            }
            sidebar_toggle.checked = sidebar === 'visible';
            body.classList.remove('sidebar-visible');
            body.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded "><a href="self_hosted.html"><strong aria-hidden="true">1.</strong> Self Hosted</a></li><li class="chapter-item expanded "><a href="enterprise_security.html"><strong aria-hidden="true">2.</strong> Enterprise Security</a></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <!-- Track and set sidebar scroll position -->
        <script>
            var sidebarScrollbox = document.querySelector('#sidebar .sidebar-scrollbox');
            sidebarScrollbox.addEventListener('click', function(e) {
                if (e.target.tagName === 'A') {
                    sessionStorage.setItem('sidebar-scroll', sidebarScrollbox.scrollTop);
                }
            }, { passive: true });
            var sidebarScrollTop = sessionStorage.getItem('sidebar-scroll');
            sessionStorage.removeItem('sidebar-scroll');
            if (sidebarScrollTop) {
                // preserve sidebar scroll position when navigating via links within sidebar
                sidebarScrollbox.scrollTop = sidebarScrollTop;
            } else {
                // scroll sidebar to current active section when navigating via "next/previous chapter" buttons
                var activeSection = document.querySelector('#sidebar .active');
                if (activeSection) {
                    activeSection.scrollIntoView({ block: 'center' });
                }
            }
        </script>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="sidebar-toggle" class="icon-button" for="sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </label>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">GitNotebooks Docs</h1>

                    <div class="right-buttons">
                        <a href="print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                        <a href="https://github.com/GitNotebooks/GitNotebooks" title="Git repository" aria-label="Git repository">
                            <i id="git-repository-button" class="fa fa-github"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="self-hosted"><a class="header" href="#self-hosted">Self Hosted</a></h1>
<p><em>This tutorial shows how to deploy self-hosted GitNotebooks to a GitHub Enterprise account</em></p>
<h3 id="before-we-start-the-tutorial"><a class="header" href="#before-we-start-the-tutorial">Before we start the tutorial</a></h3>
<p>The tutorial is divided into several sections:</p>
<ul>
<li><a href="self_hosted.html#choosing-an-endpoint">Choosing an Endpoint</a></li>
<li><a href="self_hosted.html#creating-a-github-app">Creating a GitHub App</a></li>
<li><a href="self_hosted.html#creating-a-database">Creating a Database</a></li>
<li><a href="self_hosted.html#reviewing-environment-variables">Reviewing the Environment Variables</a></li>
<li><a href="self_hosted.html#deploy-container">Deploy container</a></li>
</ul>
<p>The goal is to create a set of environment variables that look like this:</p>
<pre><code class="language-bash">BASE_URL=https://gitnotebooks.mycompany.com
GITHUB_BASE_URL=https://github.mycompany.com
GITHUB_APP_IDENTIFIER=499732
GITHUB_CLIENT_SECRET=0f2e9190d598624847d2b259b5b567cf981d5072
GITHUB_PRIVATE_KEY=LS0tLS12dJQkFNB2s3emt2dBS0nRzbXQzVCRUdJUUVBc2pzNFRSb0ErUVdWdMbFZUeklyQmtkYkZFURSBTXZiZnlqQW9FHU0EgUFJJVk1YWZWUGxaV1NOKUTiBSbNi9HOUTV0YLRVktLS0tLQpCg==
GITHUB_WEBHOOK_SECRET=d1ae70aaf90bd909ce44927350d9aba8c1136d34
GITHUB_APP_URL=https://github.mycompany.com/apps/gitnotebooks-self-hosted
NEXT_PUBLIC_GITHUB_BASE_URL=https://github.com
NEXT_PUBLIC_GITHUB_CLIENT_ID=Iv1.fed2b15afabbc1a6
DATABASE_URL=postgresql://postgres:somepassword@git-notebooks.database.url.rds.amazonaws.com:5432/postgres
AES_ENCRYPTION_KEY=X9CSf8y7Pw9dYSJNUwV4L7jUqH42/Mb27pHBRTUWceI=
NEXT_PUBLIC_ENTERPRISE=true
</code></pre>
<p>In this tutorial, we’ll note an environment variables with this notation: <code>SOME_ENV_VAR</code></p>
<h3 id="prerequisites"><a class="header" href="#prerequisites">Prerequisites</a></h3>
<p>We’ll assume that you have enough permission to create a new GitHub app and a Postgres database. We’ll also assume that you have access to the private GitNotebooks container image.</p>
<p>If you have not yet received the GitNotebooks container image, you can do so by filling out this form: <a href="https://form.typeform.com/to/pjV6jHKr">Self-hosted signup</a></p>
<h2 id="choosing-an-endpoint"><a class="header" href="#choosing-an-endpoint">Choosing an Endpoint</a></h2>
<p>Whether you’re hosting this service at a URL like <code>gitnotebooks.yourcompanydomain.com</code>, or a private IP address, it’s helpful to decide what the endpoint will be up front. We will refer to this URL as the <code>BASE_URL</code>.</p>
<pre><code class="language-bash"># Example base URL
BASE_URL="https://gitnotebooks.yourcompanydomain.com"
</code></pre>
<h2 id="creating-a-github-app"><a class="header" href="#creating-a-github-app">Creating a GitHub App</a></h2>
<p>First, click <strong>New GitHub App</strong>. If you need help finding this button, the GitHub docs can help: <a href="https://docs.github.com/en/enterprise-cloud@latest/apps/creating-github-apps/registering-a-github-app/registering-a-github-app">Registering a GitHub App</a>
Here’s how to fill out the form:</p>
<img alt="register GitNotebooks GitHub App 1" src="images/gh-app-1.png" width="500px" />
<img alt="register GitNotebooks GitHub App 2" src="images/gh-app-2.png" width="500px" />
<img alt="register GitNotebooks GitHub App 3" src="images/gh-app-3.png" width="500px" />
<img alt="register GitNotebooks GitHub App 4" src="images/gh-app-4.png" width="500px" />
<img alt="register GitNotebooks GitHub App 5" src="images/gh-app-5.png" width="500px" />
<p>You should now have a GitHub App with the following settings:</p>
<ul>
<li>GitHub App Name: <code>GitNotebooks</code></li>
<li>Homepage URL: <code>https://gitnotebook.com</code></li>
<li>Callback URL: <code>https://gitnotebooks.your-domain.com/api/auth/callback/github</code></li>
<li>Post installation: <code>https://gitnotebooks.your-domain.com/dashboard</code></li>
<li>Webhook URL: <code>https://gitnotebooks.your-domain.com/api/event_handler</code></li>
<li>Webhook secret: A custom webhook seceret</li>
<li>Permissions
<ul>
<li>Contents: <code>Read and write</code></li>
<li>Pull requests: <code>Read and write</code></li>
<li>Email address: <code>Read only</code></li>
</ul>
</li>
<li>Subscribe to events:
<ul>
<li>Pull request</li>
</ul>
</li>
</ul>
<h3 id="after-creating-the-github-app"><a class="header" href="#after-creating-the-github-app">After creating the GitHub App</a></h3>
<p>We'll need to collect some information for GitNotebooks to identify itself as the GitHub App.</p>
<p><strong>Generate a new client secret <code>GITHUB_CLIENT_SECRET</code></strong></p>
<img alt="generate client secret" src="images/gh-app-client-secrets.png" width="300px" />
<p><strong>Generate a private key</strong>
We will download the key, then convert it to base64.</p>
<img alt="download private key for GitHub App" src="images/gh-app-private-key.png" width="300px" />
<p>Convert the key to base64.</p>
<pre><code class="language-bash">cat path/to/your/key.pem | base64
</code></pre>
<p><strong>Note the url of the public page <code>GITHUB_APP_URL</code></strong></p>
<p>This URL is used to direct users to add repos to the GitHub app installation.</p>
<img src="images/public-url.png" alt="public url link for GitHub App" width="200"/>
<h3 id="making-it-pretty-optional"><a class="header" href="#making-it-pretty-optional">Making it pretty (optional)</a></h3>
<p>Finally, you can upload a <a href="images/logo.png">logo</a> which is used as the app's avatar.</p>
<h2 id="creating-a-database"><a class="header" href="#creating-a-database">Creating a database</a></h2>
<p>Next, we need a Postgres database with the following specifications:</p>
<ul>
<li>1GB RAM</li>
<li>20GiB storage</li>
<li>PostgreSQL 9.4 or higher</li>
<li>Username/Password authentication</li>
</ul>
<p><em>We recommend that your database not be accessible to the internet, and restrict inbound connections to the web servers hosting the container over TCP port 5432.</em></p>
<p>Note the connection string, which is the <code>DATABASE_URL</code></p>
<pre><code class="language-bash">DATABASE_URL="postgresql://USER:PASSWORD@HOST:PORT/DATABASE"
</code></pre>
<h2 id="reviewing-environment-variables"><a class="header" href="#reviewing-environment-variables">Reviewing the Environment Variables</a></h2>
<p>We should have all the environment variables we need:</p>
<pre><code class="language-bash"># From `Choosing and Endpoint`
BASE_URL=https://gitnotebooks.mycompany.com

# Your comapany's GitHub Enterprise URL
GITHUB_BASE_URL=https://github.mycompany.com

# From `Creating a GitHub App`
GITHUB_APP_IDENTIFIER=499732
NEXT_PUBLIC_GITHUB_CLIENT_ID=Iv1.fed2b15afabbc1a6
GITHUB_CLIENT_SECRET=0f2e9190d598624847d2b259b5b567cf981d5072
GITHUB_PRIVATE_KEY=LS0tLS12dJQkFNB2s3emt2dBS0nRzbXQzVCRUdJUUVBc2pzNFRSb0ErUVdWdMbFZUeklyQmtkYkZFURSBTXZiZnlqQW9FHU0EgUFJJVk1YWZWUGxaV1NOKUTiBSbNi9HOUTV0YLRVktLS0tLQpCg==
GITHUB_WEBHOOK_SECRET=d1ae70aaf90bd909ce44927350d9aba8c1136d34
GITHUB_APP_URL=https://github.mycompany.com/apps/gitnotebooks-self-hosted

# Base URL of your GitHub instance, if using GitHub Enterprise Cloud, use the following example:
NEXT_PUBLIC_GITHUB_BASE_URL=https://github.com

# From `Creating a database`
DATABASE_URL=postgresql://postgres:somepassword@git-notebooks.database.url.rds.amazonaws.com:5432/postgres

# Generate this value using `openssl rand -base64 32`
AES_ENCRYPTION_KEY=X9CSf8y7Pw9dYSJNUwV4L7jUqH42/Mb27pHBRTUWceI=

NEXT_PUBLIC_ENTERPRISE=true
</code></pre>
<p>You are now ready to deploy GitNotebooks Self Hosted.</p>
<h2 id="deploy-container"><a class="header" href="#deploy-container">Deploying a container</a></h2>
<p>The final step is to deploy the GitNotebooks container image with these environment variables. Whle GitNotebooks Self Hosted will not make any network requests apart from GitHub, we recommend the following security settings:</p>
<ul>
<li>Web application servers
<ul>
<li>Container environment variables stored as secrets (e.g. AWS Secrets Manager)</li>
<li>Outbound network traffic restrictred to GitHub and Database</li>
<li>Inbound traffic restricted to corpotate VPN</li>
</ul>
</li>
<li>Database
<ul>
<li>Encrypted at rest</li>
<li>Require SSL connections from web server</li>
<li>Inbound restricted to web servers via TCP port 5432</li>
<li>No outbound network requests</li>
</ul>
</li>
<li>Application load balancer
<ul>
<li>Restrict inbound requests to coroporate VPN and GitHub Webhooks</li>
<li>Restrict outbound requests to web application</li>
</ul>
</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="gitnotebooks-enterprise-security"><a class="header" href="#gitnotebooks-enterprise-security">GitNotebooks Enterprise Security</a></h1>
<p>This page offers an overview of GitNotebooks security-related features. Note that while there are many ways to configure GitNotebooks we'll only discuss the most secure configuration here.</p>
<p>Everything on this page applies to both self-hosted and managed Enterprise instances. A managed instance is just a self-hosted instance that we run for you (outside your VPN), configured as follows:</p>
<ul>
<li>GitNotebooks web application servers and image storage run in AWS.</li>
<li>All secrets are stored in AWS Secret Manager, with audit trails enabled.</li>
</ul>
<h2 id="architecture"><a class="header" href="#architecture">Architecture</a></h2>
<p>This is the recommended architecture for a self-hosted deployment, which is also used for the managed Enterprise instances. The diagram summarizes the various components and how they communicate:</p>
<img src="./images/architecture.png" alt="Architecture diagram" width="700" />
<p>If using GitHub Enterprise Server, the communication to GitHub remains within your VPN. If using a corporate VPN, all communication from the client remains within the VPN, and the Web Application Firewall is unnecessary.</p>
<h2 id="network-security"><a class="header" href="#network-security">Network Security</a></h2>
<div class="table-wrapper"><table><thead><tr><th>Service</th><th>Inbound</th><th>Outbound</th><th>Internet-Facing</th><th>Internet Access</th></tr></thead><tbody>
<tr><td>Application Load Balancer</td><td>TCP:80 (redirect to 443) <br> TCP:443 GitHub and Corporate VPN</td><td>TCP:3000 Web application security group</td><td>Yes</td><td>N/A</td></tr>
<tr><td>Web application instance</td><td>TCP:3000 ALB security group</td><td>TCP:443 GitHub <br> TCP:443 Bugsnag</td><td>No</td><td>Yes</td></tr>
<tr><td>RDS Postgres</td><td>TCP:5432 Web application security group</td><td>None</td><td>No</td><td>No</td></tr>
</tbody></table>
</div>
<h2 id="data-encryption"><a class="header" href="#data-encryption">Data Encryption</a></h2>
<p><strong>Data Encyption At Rest</strong></p>
<p>There are two pieces of sensitive data stored by the application. Both are AES encypted at rest:</p>
<ul>
<li>GitHub Auth Tokens</li>
<li>Comment Body</li>
</ul>
<p>In the case of self-hosted, the encyption key is generated by you. It's recommended that this key be stored in a secrets manager and mounted into the container image by reference.</p>
<p><strong>Data Encyption in Transit</strong></p>
<p>For Managed Enterprise accounts, the following communication is TLS encrypted:</p>
<ul>
<li>User -&gt; Application Load Balancer</li>
<li>GitHub -&gt; Applicaiton Load Balancer</li>
<li>Web application server -&gt; Database</li>
</ul>
<p>For self-hosted, it is recommended to encrypt network traffic similarly.</p>
<h2 id="authentication"><a class="header" href="#authentication">Authentication</a></h2>
<p>GitNotebooks relies entirely on GitHub Enterprise (GHE) for authentication. If you've configured your GHE instance to use SSO via SAML then GitNotebooks will use that too. There are no separate local user accounts to maintain within Gitnotebooks.</p>
<p>When a user signs in, GitNotebooks obtains and stores an OAuth token that lets it operatore on the user's behalf within the scopes that were granted. GitNotebooks needs the following scopes:</p>
<ul>
<li>Repo (read and write)</li>
<li>Pull requests (write)</li>
<li>Metadata (read and write)</li>
</ul>
<h2 id="authorization"><a class="header" href="#authorization">Authorization</a></h2>
<p>Authorizations in GitNotebooks are inferred from the permissions granted to users in GHE, i.e. repository read/write/admin and organization owner. There are no separate roles or authorizations maintained within GitNotebooks.</p>
<h2 id="data-flow"><a class="header" href="#data-flow">Data Flow</a></h2>
<p>The following diagrams illustrate the two primary workflows of GitNotebooks</p>
<img src="./images/login-data-flow.png" alt="Login Data Flow" width="700" />
<img src="./images/review-data-flow.png" alt="Review Data Flow" width="700" />
<h2 id="frequently-asked-questions"><a class="header" href="#frequently-asked-questions">Frequently Asked Questions</a></h2>
<p><strong>Does the self-hosted application send any network requests to GitNotebooks?</strong>
No, self-hosted installations do not make any network requests apart from those made to GitHub. If hosting GitHub Enterprise Server, all network traffic remains within your VPN. It is recommended that you restrict network requests from the application server to your GitHub Enterprise Cloud environment if you are not self-hosting GitHub.</p>
<p><strong>Does GitNotebooks have access to any Self Hosted data?</strong>
No, all data is stored within your own cloud environment. GitNotebooks does not have access to any of your data.</p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->


                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">

            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>


        <script src="elasticlunr.min.js"></script>
        <script src="mark.min.js"></script>
        <script src="searcher.js"></script>

        <script src="clipboard.min.js"></script>
        <script src="highlight.js"></script>
        <script src="book.js"></script>

        <!-- Custom JS scripts -->

        <script>
        window.addEventListener('load', function() {
            window.setTimeout(window.print, 100);
        });
        </script>

    </div>
    </body>
</html>
